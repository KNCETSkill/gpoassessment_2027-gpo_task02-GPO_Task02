name: Autograding Tests

on:
  - push
  - repository_dispatch

permissions:
  checks: write
  actions: read
  contents: read

jobs:
  run-autograding-tests:
    runs-on: ubuntu-latest
    if: github.actor != 'github-classroom[bot]'

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Java
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'temurin'

      # ---------- SAMPLE TEST CASES ----------

      - name: Sample 1
        id: sample-1
        uses: classroom-resources/autograding-io-grader@v1
        with:
          test-name: Sample 1
          setup-command: javac src/AttendanceStatusEvaluator.java
          command: java -cp src AttendanceStatusEvaluator
          input: "90"
          expected-output: "Excellent"
          comparison-method: exact
          timeout: 10
          max-score: 10

      - name: Sample 2
        id: sample-2
        uses: classroom-resources/autograding-io-grader@v1
        with:
          test-name: Sample 2
          setup-command: javac src/AttendanceStatusEvaluator.java
          command: java -cp src AttendanceStatusEvaluator
          input: "75"
          expected-output: "Satisfactory"
          comparison-method: exact
          timeout: 10
          max-score: 10

      # ---------- HIDDEN TEST CASES ----------

      - name: Hidden 1
        id: hid-1
        uses: classroom-resources/autograding-io-grader@v1
        with:
          test-name: Hidden 1
          setup-command: javac src/AttendanceStatusEvaluator.java
          command: java -cp src AttendanceStatusEvaluator
          input: "45"
          expected-output: "Poor"
          comparison-method: exact
          timeout: 10
          max-score: 10

      - name: Hidden 2
        id: hid-2
        uses: classroom-resources/autograding-io-grader@v1
        with:
          test-name: Hidden 2
          setup-command: javac src/AttendanceStatusEvaluator.java
          command: java -cp src AttendanceStatusEvaluator
          input: "60"
          expected-output: "Satisfactory"
          comparison-method: exact
          timeout: 10
          max-score: 10

      - name: Hidden 3
        id: hid-3
        uses: classroom-resources/autograding-io-grader@v1
        with:
          test-name: Hidden 3
          setup-command: javac src/AttendanceStatusEvaluator.java
          command: java -cp src AttendanceStatusEvaluator
          input: "85"
          expected-output: "Satisfactory"
          comparison-method: exact
          timeout: 10
          max-score: 10

      # ---------- AUTOGRADING REPORT ----------

      - name: Autograding Reporter
        uses: classroom-resources/autograding-grading-reporter@v1
        env:
          SAMPLE-1_RESULTS: "${{steps.sample-1.outputs.result}}"
          SAMPLE-2_RESULTS: "${{steps.sample-2.outputs.result}}"
          HID-1_RESULTS: "${{steps.hid-1.outputs.result}}"
          HID-2_RESULTS: "${{steps.hid-2.outputs.result}}"
          HID-3_RESULTS: "${{steps.hid-3.outputs.result}}"
        with:
          runners: sample-1,sample-2,hid-1,hid-2,hid-3
          fail-on-error: true
